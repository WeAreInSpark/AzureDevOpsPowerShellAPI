<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Workflow - none</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Workflow";
        var mkdocs_page_input_path = "en-US/about_workflow.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> none
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">en US</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../Get-AzDoProject/">Get-AzDoProject</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Get-AzDoRepo/">Get-AzDoRepo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AadAppRegistration/">New-AadAppRegistration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AadAppRegistrationCertificate/">New-AadAppRegistrationCertificate</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AadAppRegistrationSecret/">New-AadAppRegistrationSecret</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AadGroup/">New-AadGroup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoPipeline/">New-AzDoPipeline</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoProject/">New-AzDoProject</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoRepo/">New-AzDoRepo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoRepoClone/">New-AzDoRepoClone</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoRepoFork/">New-AzDoRepoFork</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoServiceConnection/">New-AzDoServiceConnection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../New-AzDoVariableGroup/">New-AzDoVariableGroup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Set-AzDOProjectSetting/">Set-AzDoProjectSetting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Set-AzDoTeamMember/">Set-AzDoTeamMember</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../about_InfrastructureAsCode.help/">InfrastructureAsCode</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../about_InstallingModule/">Installing module</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Workflow</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#pull-request-labels">Pull request labels</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#unit-testing">Unit testing</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#search-for-previous-tags">Search for previous tags</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#calculating-the-new-version">Calculating the new version</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#updating-the-manifest">Updating the manifest</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#create-a-github-release">Create a github release</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#publishing-the-module">Publishing the module</a>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">none</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>en US &raquo;</li>
      <li>Workflow</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/WeAreInSpark/BRC.PS.InfrastructureAsCode/edit/master/docs/en-US/about_workflow.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="workflow">Workflow</h1>
<p>In this document we will describe how our test en release workflow works. The test workflow starts when a pull request opens and the release workflow starts when there is a commit on the main branch with a change in the folder InSpark.InfrastructureAsCode.</p>
<p><img alt="Image" src="../images/workflow.png" /></p>
<h2 id="pull-request-labels">Pull request labels</h2>
<p>When a pull request opens the test workflow wil start to set labels based on the head branch. You can find the labels in the file <a href="../../.github/pr-labeler.yml">pr-labeler.yml</a>. The labels are used in other actions to determine the version or changes. The workflow will check if one of these labels are set and will then be added as a reviewer. You can also choose to set the labels manually if you are not on the right branch.</p>
<p>Reference:</p>
<ul>
<li><a href="https://github.com/TimonVS/pr-labeler-action">Github - TimonVS - pr-labeler-action</a></li>
<li><a href="https://github.com/NathanielHill/check-pr-label-action">Github - NathanielHill - check-pr-label-action</a></li>
</ul>
<h2 id="unit-testing">Unit testing</h2>
<p>Before merging the PR, PSake will test the module with Pester and PSScriptAnalyzer. This will be done multiple times on different operating systems (Windows, Linux, Mac OS). The Pester tests are located in <a href="../../tests">tests/</a> and the PSScriptAnalyzer settings can be found in <a href="../../tests/ScriptAnalyzerSettings.psd1">ScriptAnalyzerSettings.psd1</a>.</p>
<p>Reference:</p>
<ul>
<li><a href="https://github.com/psake/PowerShellBuild">Github - PowerShellBuild</a></li>
</ul>
<h2 id="search-for-previous-tags">Search for previous tags</h2>
<p>When the labels are present and the unit tests completes whithout any errors the pull request will be merged intoo the main branch and the release workflow will start. The first action that takes place is the search for previous tags. This is needed to determine the new version of the module. When there are no tags found, the version 0.0.0 will be given.</p>
<p>Reference:</p>
<ul>
<li><a href="https://github.com/WyriHaximus/github-action-get-previous-tag">github-action-get-previous-tag</a></li>
</ul>
<h2 id="calculating-the-new-version">Calculating the new version</h2>
<p>All our versions are SemVer based and are calculated based on the labels that are set in the pull request. Examples:</p>
<ul>
<li>patch: 0.0.0 -&gt; 0.0.1</li>
<li>minor: 0.0.0 -&gt; 0.1.0</li>
<li>major: 0.0.0 -&gt; 1.0.0</li>
</ul>
<h2 id="updating-the-manifest">Updating the manifest</h2>
<p>The manifest <a href="../../InSpark.InfrastructureAsCode/InSpark.InfrastructureAsCode.psd1">InSpark.InfrastructureAsCode.psd1</a> will be updated with the following information:</p>
<ul>
<li>New version</li>
<li>Release notes (The name of the pull request)</li>
<li>The Project URL (The Github repo URL)</li>
</ul>
<h2 id="create-a-github-release">Create a github release</h2>
<p>There will be github release created based on a template that can be found in <a href="../../.github/release.yml">release.yml</a>. The template will look for All pull request between to the versions based on SemVer and add the pull request title and link to different sections. Because this workflow runs after every pull request there will always be one pull request linked in the github release.</p>
<p>Reference:</p>
<ul>
<li><a href="https://docs.github.com/en/repositories/releasing-projects-on-github/automatically-generated-release-notes">Github - Automatically generated release notes</a></li>
</ul>
<h2 id="publishing-the-module">Publishing the module</h2>
<p>When the manifest is updated the module is ready to be published. We use PSake to publish the module as well.
We first make sure that the PowerShell repository is registered. For this reason we switched to a Windows runner, because the CmdLet Register-PSRepository does not work on a Linux runner. After this we will PSake publish the module to the repository. This will only work if the version is higher then the latest available version.</p>
<p>Reference:</p>
<ul>
<li><a href="https://github.com/psake/PowerShellBuild">Github - PowerShellBuild</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/tutorials/private-powershell-library?view=azure-devops">Azure DevOps - Use an Azure Artifacts feed as a private PowerShell repository</a></li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../about_InstallingModule/" class="btn btn-neutral float-left" title="Installing module"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/WeAreInSpark/BRC.PS.InfrastructureAsCode" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../about_InstallingModule/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
